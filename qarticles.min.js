"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();!function(t){var e=[],i=function(t){for(var e=void 0,i=1;i<arguments.length;i++)e=arguments[i],Array.prototype.push.apply(t,e)},s=function(){function t(e){var i=arguments.length<=1||void 0===arguments[1]?0:arguments[1],s=arguments.length<=2||void 0===arguments[2]?null:arguments[2];_classCallCheck(this,t),this.objects=[],this.nodes=[],this.level=i,this.bounds=e,this.parent=s,this.MAX_OBJECTS=10,this.MAX_LEVELS=5}return _createClass(t,[{key:"clear",value:function(){for(this.objects.length=0;this.nodes.length;){var t=this.nodes.shift();t.clear()}}},{key:"split",value:function(){var e=this.bounds.x,i=this.bounds.y,s=this.bounds.sWidth,n=this.bounds.sHeight;this.nodes.push(new t(new r(this.bounds.cX,i,s,n),this.level+1,this),new t(new r(e,i,s,n),this.level+1,this),new t(new r(e,this.bounds.cY,s,n),this.level+1,this),new t(new r(this.bounds.cX,this.bounds.cY,s,n),this.level+1,this))}},{key:"getIndex",value:function(t,e){var i=t.y+t.h<=this.bounds.cY,s=t.y>=this.bounds.cY,r=t.x+t.w<=this.bounds.cX,n=t.x>=this.bounds.cX;if(e&&(Math.abs(t.cX-this.bounds.cX)+t.sWidth>this.bounds.sWidth||Math.abs(t.cY-this.bounds.cY)+t.sHeight>this.bounds.sHeight))return-1;if(i){if(n)return 0;if(r)return 1}else if(s){if(r)return 2;if(n)return 3}return-1}},{key:"insert",value:function(t){if(this.nodes.length){var e=this.getIndex(t);if(-1!==e)return void this.nodes[e].insert(t)}if(this.objects.push(t),!this.nodes.length&&this.objects.length>this.MAX_OBJECTS&&this.level<this.MAX_LEVELS){this.split();for(var i=this.objects.length-1;i>=0;i--){var s=this.getIndex(this.objects[i]);-1!==s&&this.nodes[s].insert(this.objects.splice(i,1)[0])}}}},{key:"refresh",value:function(t){t=t||this;for(var e=this.objects.length-1;e>=0;e--){var i=this.getIndex(this.objects[e],!0);-1===i?this.parent&&this.parent.insert(this.objects.splice(e,1)[0]):this.nodes.length&&this.nodes[i].insert(this.objects.splice(e,1)[0])}for(var s=0,r=this.nodes.length;r>s;s++)this.nodes[s].refresh(t)}},{key:"retrieve",value:function(t){var s=e;if(0===this.level&&(s.length=0),i(s,this.objects),this.nodes.length){var r=this.getIndex(t);if(-1!==r)this.nodes[r].retrieve(t);else for(var n=t.carve(this.bounds.cX,this.bounds.cY),h=n.length-1;h>=0;h--)r=this.getIndex(n[h]),this.nodes[r].retrieve(t)}return s}}]),t}(),r=function(){function t(e,i,s,r){var n=arguments.length<=4||void 0===arguments[4]?{0:20,1:20}:arguments[4];_classCallCheck(this,t),this.speedArr=n,this.nextSpeedArr={0:this.speedArr[0],1:this.speedArr[1]},this.resize(s,r),this.moveTo(e,i)}return _createClass(t,[{key:"moveTo",value:function(t,e){this.x=t,this.y=e,this.cX=t+this.sWidth,this.cY=e+this.sHeight}},{key:"resize",value:function(t,e){this.w=t,this.h=e,this.sWidth=t/2,this.sHeight=e/2}},{key:"draw",value:function(t){t.save(),t.beginPath(),t.rect(this.x,this.y,this.w,this.h),t.closePath(),t.restore()}},{key:"run",value:function(){this.speedArr[0]=this.nextSpeedArr[0],this.speedArr[1]=this.nextSpeedArr[1],this.moveTo(this.x+.016*this.speedArr[0],this.y+.016*this.speedArr[1])}},{key:"copy",value:function(t){this.resize(t.w,t.h),this.moveTo(t.x,t.y),this.nextSpeedArr[0]=t.speedArr[0],this.nextSpeedArr[1]=t.speedArr[1]}},{key:"init",value:function(t,e,i,s,r){this.resize(i,s),this.moveTo(t,e)}},{key:"collide",value:function(t,e){var i=h[0],s=h[1],r=void 0,n=void 0,o=void 0,a=void 0,c=void 0,u=void 0,l=void 0;if(e)Math.abs(this.cX-t.cX)+this.sWidth>t.sWidth&&(this.nextSpeedArr[0]=-(this.nextSpeedArr[0]||this.speedArr[0]),this.moveTo(this.cX>t.cX?t.x+t.w-this.w:t.x,this.y)),Math.abs(this.cY-t.cY)+this.sHeight>t.sHeight&&(this.nextSpeedArr[1]=-(this.nextSpeedArr[1]||this.speedArr[1]),this.moveTo(this.x,this.cY>t.cY?t.y+t.h-this.h:t.y));else{for(i.copy(this),s.copy(t),r=i.sWidth+s.sWidth,n=i.sHeight+s.sHeight,o=r-Math.abs(i.cX-s.cX),a=n-Math.abs(i.cY-s.cY);o>0&&a>0;)i.run(-16),s.run(-16),o=r-Math.abs(i.cX-s.cX),a=n-Math.abs(i.cY-s.cY);c=0>=o,u=0>=a,c&&(l=this.cX>t.cX?1:-1,this.nextSpeedArr[0]=l*(Math.abs(this.nextSpeedArr[0])+Math.abs(t.speedArr[0]))/2),u&&(l=i.cY>s.cY?1:-1,this.nextSpeedArr[1]=l*(Math.abs(this.nextSpeedArr[1])+Math.abs(t.speedArr[1]))/2)}}},{key:"carve",value:function(e,i){var s=[],r=[],n=e-this.x,h=i-this.y,o=n>0&&n<this.w,a=h>0&&h<this.h;if(o&&a)for(r=this.carve(e,this.y);r.length;)s=s.concat(r.shift().carve(this.x,i));else o?s.push(new t(this.x,this.y,n,this.h),new t(e,this.y,this.w-n,this.h)):a&&s.push(new t(this.x,this.y,this.w,h),new t(this.x,i,this.w,this.h-h));return s}},{key:"isApproach",value:function(t,e){var i=h[0],s=h[1];return i.copy(t),s.copy(e),i.run(),s.run(),+(Math.pow(t.cX-e.cX,2)-Math.pow(i.cX-s.cX,2)+Math.pow(t.cY-e.cY,2)-Math.pow(i.cY-s.cY,2)).toFixed(6)>0?!0:!1}},{key:"isCollide",value:function(t,e){Math.abs(t.cX-e.cX)<t.sWidth+e.sWidth&&Math.abs(t.cY-e.cY)<t.sHeight+e.sHeight&&this.isApproach(t,e)&&(t.collide(e),e.collide(t))}}]),t}(),n=function(t){function e(t,i,s,r){var n=arguments.length<=4||void 0===arguments[4]?{0:10,1:10}:arguments[4],h=arguments[5],o=arguments[6],a=arguments[7];_classCallCheck(this,e);var c=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,i,s,r,n));return c.x=t,c.y=i,c.radius=.5*s,c.width=s,c.height=r,c.speedArr=n,c.nextSpeedArr={0:c.speedArr[0],1:c.speedArr[1]},c.linkCount=h,c.dotColorFuc=o,c.lineColorFuc=a,c.dotColor="#ccc",c.lineColor="#ccc",c.linkingCount=0,c.updateColor(),c}return _inherits(e,t),_createClass(e,[{key:"updateColor",value:function(t,e){this.dotColor=this.dotColorFuc(this,t,e),this.lineColor=this.lineColorFuc(this,t,e)}},{key:"run",value:function(t,e){this.limit(t,e),this.speedArr[0]=this.nextSpeedArr[0],this.speedArr[1]=this.nextSpeedArr[1],this.moveTo(this.x+.016*this.speedArr[0],this.y+.016*this.speedArr[1]),this.updateColor(t,e)}},{key:"draw",value:function(t){t.fillStyle=this.dotColor,t.save(),t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI,!0),t.fill(),t.restore(),this.linkingCount=0}},{key:"limit",value:function(t,e){(this.x+this.sWidth>=t||this.x-this.sWidth<=0)&&(this.nextSpeedArr[0]=-this.nextSpeedArr[0]),(this.y+this.sHeight>=e||this.y-this.sHeight<=0)&&(this.nextSpeedArr[1]=-this.nextSpeedArr[1])}},{key:"linkWith",value:function(t,e){e.strokeStyle=this.lineColor,e.lineWidth=.4,e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(t.x,t.y),e.stroke(),e.closePath(),e.save(),t.linkingCount++}},{key:"canLink",value:function(t,e){var i=this;t.forEach(function(t){t.linkingCount<t.linkCount&&i.linkWith(t,e)})}},{key:"isCollide",value:function(t,e){Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<Math.pow(t.radius+e.radius,2)&&this.isApproach(t,e)&&(t.collide(e),e.collide(t))}}]),e}(r),h=[];h.push(new r(0,0,0,0),new r(0,0,0,0));var o=window.innerWidth,a=window.innerHeight-10,c=function(t,e,i){return"rgb("+Math.floor(255*(1-t.x/e))+", "+Math.floor(255*(1-t.y/i))+","+Math.floor(255*(t.speedArr[0]/100))+")"},u=function(t){return Math.random()*t*(10*Math.random()>5?-1:1)},l=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.min||0,i=t.max||20,s=t.random||!0,r=t.size||10;return s?t.size?function(){return Math.random()*r}:function(){return Math.random()*(i-e)+e}:function(){return r}},d=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.count||4,i=void 0===t.show?!0:t.show;return{count:e,show:i}},v=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=void 0===t.physical?!0:t.physical;return{physical:e,speed:t.speed||20,vxFuc:t.vxFuc||u,vyFuc:t.vyFuc||u,count:t.count||64,size:l(t.size)}},p=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{dotColorFuc:t.dotColorFuc||c,lineColorFuc:t.lineColorFuc||c}},f=function(){function t(e){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,t),this.dot=v(i.dot),this.lineLink=d(i.lineLink),this.color=p(i.color),this.screenWidth=i.screenWidth||o,this.screenHeight=i.screenHeight||a,this.dotArr=[],this.tree,this.setCanvas(e),this.init(),this.loop()}return _createClass(t,[{key:"setCanvas",value:function(t){return t?(this.canvas=t,t.height=this.screenHeight,t.width=this.screenWidth,t.setAttribute("style","height: "+this.screenHeight+"px; width: "+this.screenWidth+"px"),void(this.cxt=this.canvas.getContext("2d"))):console.error("canvas is must be requried")}},{key:"init",value:function(){this.dotArr.length=0,this.tree=new s(new r(0,0,this.screenWidth,this.screenHeight));for(var t=0;t<this.dot.count;t++){var e=this.dot.size(),i=new n(Math.floor(Math.random()*(this.screenWidth-20)),Math.floor(Math.random()*(this.screenHeight-20)),e,e,{0:this.dot.vxFuc(this.dot.speed),1:this.dot.vyFuc(this.dot.speed)},this.lineLink.count,this.color.dotColorFuc,this.color.lineColorFuc);this.dotArr.push(i),this.tree.insert(i)}}},{key:"draw",value:function(){var t=[];this.cxt.clearRect(0,0,this.screenWidth,this.screenHeight),this.tree.refresh();for(var e=0,i=this.dotArr.length;i>e;e++){if(t=this.tree.retrieve(this.dotArr[e]),this.lineLink.show&&this.dotArr[e].canLink(t,this.cxt),this.physical)for(var s=0;s<t.length;s++)this.dotArr[e].isCollide(this.dotArr[e],t[s]);this.dotArr[e].run(this.screenWidth,this.screenHeight),this.dotArr[e].draw(this.cxt)}requestAnimationFrame(this.draw.bind(this))}},{key:"loop",value:function(){requestAnimationFrame(this.draw.bind(this))}}]),t}();t.Qarticles=f}(window);